#include	<fcntl.h>
#include	<stdio.h>
#include	<string.h>
#include	<ctype.h>
#include	<malloc.h>
#include	<memory.h>
#include	"osbind.h"
#include	"vdi.h"

unsigned	short	_font0[]	=	{
1,	9,	30776,	8248,	31091,	29811,	28005,	26144,
28271,	116,	0,	0,	0,	0,	0,	0,
0,	0,	0,	255,	6,	6,	4,	1,
1,	8,	8,	1,	3,	1,	1,	21845,
21845,	9,	88,	0,	88,	0,	602,	0,
256,	8,	22118,	0,	0,	8,	16,	24,
32,	40,	48,	56,	64,	72,	80,	88,
96,	104,	112,	120,	128,	136,	144,	152,
160,	168,	176,	184,	192,	200,	208,	216,
224,	232,	240,	248,	256,	264,	272,	280,
288,	296,	304,	312,	320,	328,	336,	344,
352,	360,	368,	376,	384,	392,	400,	408,
416,	424,	432,	440,	448,	456,	464,	472,
480,	488,	496,	504,	512,	520,	528,	536,
544,	552,	560,	568,	576,	584,	592,	600,
608,	616,	624,	632,	640,	648,	656,	664,
672,	680,	688,	696,	704,	712,	720,	728,
736,	744,	752,	760,	768,	776,	784,	792,
800,	808,	816,	824,	832,	840,	848,	856,
864,	872,	880,	888,	896,	904,	912,	920,
928,	936,	944,	952,	960,	968,	976,	984,
992,	1000,	1008,	1016,	1024,	1032,	1040,	1048,
1056,	1064,	1072,	1080,	1088,	1096,	1104,	1112,
1120,	1128,	1136,	1144,	1152,	1160,	1168,	1176,
1184,	1192,	1200,	1208,	1216,	1224,	1232,	1240,
1248,	1256,	1264,	1272,	1280,	1288,	1296,	1304,
1312,	1320,	1328,	1336,	1344,	1352,	1360,	1368,
1376,	1384,	1392,	1400,	1408,	1416,	1424,	1432,
1440,	1448,	1456,	1464,	1472,	1480,	1488,	1496,
1504,	1512,	1520,	1528,	1536,	1544,	1552,	1560,
1568,	1576,	1584,	1592,	1600,	1608,	1616,	1624,
1632,	1640,	1648,	1656,	1664,	1672,	1680,	1688,
1696,	1704,	1712,	1720,	1728,	1736,	1744,	1752,
1760,	1768,	1776,	1784,	1792,	1800,	1808,	1816,
1824,	1832,	1840,	1848,	1856,	1864,	1872,	1880,
1888,	1896,	1904,	1912,	1920,	1928,	1936,	1944,
1952,	1960,	1968,	1976,	1984,	1992,	2000,	2008,
2016,	2024,	2032,	2040,	2048,	6144,	6204,	15384,
59391,	32257,	6168,	61680,	40965,	1660,	31868,	31942,
31868,	31868,	30720,	61447,	1041,	6144,	102,	24,
6200,	28686,	0,	0,	512,	6204,	32316,	32268,
32316,	15420,	0,	6,	15456,	6204,	15484,	32376,
15998,	15462,	26118,	50784,	15462,	15484,	15484,	26238,
50790,	26214,	7806,	30784,	16,	0,	96,	6,
28,	6240,	24600,	56,	0,	0,	0,	0,
0,	0,	3584,	28696,	0,	26112,	6156,	12390,
24,	26136,	26160,	24600,	6246,	12,	6207,	12390,
12312,	26214,	6246,	26140,	7708,	3084,	3084,	13364,
0,	0,	50688,	198,	55323,	13364,	2,	32512,
13360,	26164,	12,	32378,	61822,	63078,	0,	0,
0,	0,	96,	24576,	0,	0,	0,	0,
0,	0,	0,	3584,	26112,	7168,	0,	254,
0,	60,	7168,	12,	15422,	6144,	3120,	6144,
24,	14392,	0,	14392,	120,	15360,	7204,	39224,
50175,	49923,	7228,	49344,	40965,	1734,	1542,	49350,
1728,	50886,	24576,	63503,	10251,	6144,	27750,	26174,
6252,	14364,	6246,	0,	1536,	14438,	3174,	24604,
1632,	26214,	6168,	12,	26160,	15462,	26214,	24684,
24672,	6246,	27654,	61024,	26230,	26214,	26214,	26136,
50790,	26214,	6150,	6240,	56,	192,	96,	6,
48,	96,	24576,	24,	0,	0,	0,	24,
0,	0,	6144,	6168,	6240,	60,	26136,	6144,
24,	102,	24,	12390,	0,	24,	26232,	6144,
6246,	0,	6144,	26170,	12342,	6168,	6168,	22616,
15420,	24,	52224,	6348,	27702,	22616,	572,	55296,
22552,	88,	4120,	50122,	23491,	26112,	31846,	32286,
7292,	32286,	15470,	32318,	7276,	13886,	26238,	30782,
31958,	15900,	32510,	6966,	63248,	13824,	254,	7782,
0,	15384,	13884,	4120,	26224,	6270,	6168,	6158,
12824,	31852,	0,	27756,	65036,	26112,	63012,	50031,
39422,	54022,	5692,	57342,	40965,	1734,	1542,	49350,
1728,	50886,	30780,	60447,	55309,	6144,	65126,	27744,
6200,	6168,	6204,	0,	3072,	6254,	6150,	31804,
3168,	26214,	6168,	32280,	1560,	26222,	24678,	24678,
24672,	6246,	30726,	65120,	26238,	26214,	24678,	26136,
50790,	26172,	6156,	6192,	108,	15456,	15484,	15422,
15996,	14460,	26136,	60440,	15484,	15996,	15996,	26238,
50790,	26214,	6270,	6168,	6386,	102,	0,	60,
15360,	15360,	0,	0,	6168,	32382,	216,	0,
0,	15462,	15462,	15408,	31846,	0,	0,	0,
26118,	0,	55296,	216,	13932,	0,	15462,	55422,
0,	60,	14384,	48586,	24509,	26342,	3190,	3078,
3078,	13836,	3174,	1542,	3134,	13878,	26214,	3078,
27862,	1548,	26214,	15414,	39224,	26230,	65126,	14384,
32364,	26172,	30822,	31800,	26208,	32256,	12300,	6171,
19456,	14392,	3840,	6252,	56,	49920,	33767,	59329,
15612,	54156,	4156,	56280,	45069,	0,	31868,	31868,
124,	31868,	24582,	1048,	10246,	6144,	27648,	6204,
112,	6168,	32511,	32256,	6144,	6262,	3084,	1644,
6268,	15932,	0,	48,	3084,	26218,	24700,	31846,
28284,	6270,	28678,	54880,	26238,	26236,	15484,	26136,
54886,	15384,	6168,	6168,	198,	1584,	24678,	26214,
26160,	6246,	27672,	65048,	26214,	26214,	24678,	26136,
50790,	26172,	12300,	3096,	13470,	26208,	15420,	15366,
24636,	26172,	14396,	14392,	15420,	7008,	15582,	15420,
26214,	26214,	24678,	6268,	12412,	14396,	26172,	26236,
26174,	15896,	13948,	6198,	7128,	15420,	28270,	57051,
6168,	102,	4096,	45514,	21925,	26214,	3132,	3086,
3174,	13830,	3174,	1542,	3174,	13878,	15478,	3126,
27862,	1548,	30310,	26140,	39276,	31964,	27746,	27672,
6252,	32358,	56422,	54868,	26238,	6270,	6168,	6171,
126,	0,	6144,	12396,	12,	59136,	33731,	50113,
39417,	56280,	4222,	65502,	45069,	1734,	1728,	1542,
1734,	1734,	32382,	1048,	53255,	6144,	27648,	12294,
222,	6168,	6204,	0,	12288,	6246,	1560,	1662,
12390,	1638,	6168,	24,	6168,	32366,	24678,	24678,
26208,	6246,	30726,	50784,	26222,	30304,	1644,	26136,
65126,	6204,	6192,	6156,	0,	15872,	24678,	32358,
26160,	6246,	30744,	54808,	26214,	26214,	15456,	26136,
54886,	26136,	6168,	6168,	13324,	26214,	1662,	1598,
24582,	32382,	6270,	6168,	26214,	32636,	26360,	26214,
26214,	26214,	24678,	15408,	12390,	6150,	26214,	30310,
26214,	12336,	27404,	6254,	13932,	26118,	30326,	55519,
15420,	102,	4096,	45434,	20921,	26214,	3182,	3102,
3174,	13830,	102,	1542,	3174,	13878,	3590,	3126,
27862,	1548,	1638,	26124,	61382,	26312,	27744,	27696,
6252,	26214,	52326,	54868,	26208,	6144,	3120,	55320,
12800,	0,	55320,	31852,	120,	9216,	63078,	39279,
50163,	50032,	28688,	7704,	38937,	1734,	1728,	1542,
1734,	1734,	6246,	1040,	4142,	0,	65024,	26236,
204,	14364,	6246,	48,	24600,	6246,	26160,	26124,
12390,	3174,	6168,	32268,	48,	26208,	26214,	24684,
26208,	6246,	27750,	50784,	26214,	27744,	26214,	26136,
60988,	6246,	6240,	6150,	0,	26112,	24678,	24678,
15920,	6246,	27672,	50712,	26214,	26214,	1632,	26136,
31804,	15932,	6192,	6168,	25088,	26172,	32352,	32358,
15486,	24672,	6240,	6168,	32382,	55392,	26328,	26214,
26214,	26174,	15462,	6192,	12390,	6270,	26214,	28262,
15422,	12384,	49932,	6358,	27702,	26238,	26214,	55512,
26214,	102,	4096,	48394,	173,	63222,	32358,	3126,
3174,	13830,	126,	3646,	15470,	32284,	32382,	3124,
60670,	1548,	1662,	15372,	26242,	26332,	27744,	27750,
6252,	26172,	60452,	54840,	26224,	126,	0,	55320,
19480,	0,	28696,	0,	0,	9216,	7228,	15416,
59367,	49952,	61496,	6936,	40569,	1660,	31868,	31750,
1660,	31868,	7740,	15390,	57401,	6144,	27648,	17944,
118,	28686,	0,	48,	16408,	32316,	15486,	15372,
12348,	14396,	12288,	6,	6240,	26174,	15484,	32376,
15968,	15462,	26172,	50814,	15462,	13920,	15462,	15896,
50712,	6246,	7806,	30722,	65024,	15872,	15484,	15422,
1584,	15462,	26136,	50748,	15462,	15996,	31840,	15886,
27672,	1638,	3710,	28696,	32256,	15880,	15932,	15934,
2110,	15420,	15420,	15420,	26214,	32382,	15583,	15420,
15934,	15366,	6206,	6270,	24700,	15422,	15932,	26214,
0,	12390,	34316,	6303,	55323,	15422,	15420,	32638,
32382,	102,	0,	49930,	195,	1542,	0,	0,
0,	0,	0,	0,	0,	0,	0,	48,
0,	1548,	1536,	55308,	0,	31862,	27744,	14590,
6271,	15384,	30822,	31792,	26174,	32256,	32382,	28696,
24,	0,	12288,	0,	0,	15360,	6168,	24,
0,	32256,	24592,	0,	36465,	0,	0,	0,
0,	0,	0,	21527,	56,	0,	0,	0,
0,	0,	0,	96,	0,	0,	0,	0,
0,	0,	0,	0,	0,	0,	0,	0,
0,	0,	0,	0,	0,	0,	0,	0,
0,	0,	0,	0,	0,	0,	0,	0,
31744,	0,	112,	0,	0,	1632,	0,	0,
0,	31744,	0,	24,	0,	56,	0,	0,
6144,	0,	0,	0,	0,	0,	0,	0,
0,	124,	6144,	0,	96,	0,	0,	0,
15420,	60,	3840,	6150,	0,	0,	16448,	0,
26214,	60,	0,	32266,	126,	7196,	0,	0,
0,	0,	0,	0,	0,	0,	0,	0,
0,	0,	0,	28672,	0,	24576,	18680,	0,
4288,	60,	0,	4192,	0,	0,	0,	24,
0,	0,	0,	0,	0,	
};
unsigned	short	_font1[]	=	{
1,	10,	30776,	13873,	29472,	29561,	25972,	8301,
28518,	29806,	0,	0,	0,	0,	0,	0,
0,	0,	0,	255,	13,	11,	8,	2,
2,	8,	8,	1,	7,	1,	1,	21845,
21845,	8,	88,	0,	88,	0,	602,	0,
256,	16,	0,	0,	0,	8,	16,	24,
32,	40,	48,	56,	64,	72,	80,	88,
96,	104,	112,	120,	128,	136,	144,	152,
160,	168,	176,	184,	192,	200,	208,	216,
224,	232,	240,	248,	256,	264,	272,	280,
288,	296,	304,	312,	320,	328,	336,	344,
352,	360,	368,	376,	384,	392,	400,	408,
416,	424,	432,	440,	448,	456,	464,	472,
480,	488,	496,	504,	512,	520,	528,	536,
544,	552,	560,	568,	576,	584,	592,	600,
608,	616,	624,	632,	640,	648,	656,	664,
672,	680,	688,	696,	704,	712,	720,	728,
736,	744,	752,	760,	768,	776,	784,	792,
800,	808,	816,	824,	832,	840,	848,	856,
864,	872,	880,	888,	896,	904,	912,	920,
928,	936,	944,	952,	960,	968,	976,	984,
992,	1000,	1008,	1016,	1024,	1032,	1040,	1048,
1056,	1064,	1072,	1080,	1088,	1096,	1104,	1112,
1120,	1128,	1136,	1144,	1152,	1160,	1168,	1176,
1184,	1192,	1200,	1208,	1216,	1224,	1232,	1240,
1248,	1256,	1264,	1272,	1280,	1288,	1296,	1304,
1312,	1320,	1328,	1336,	1344,	1352,	1360,	1368,
1376,	1384,	1392,	1400,	1408,	1416,	1424,	1432,
1440,	1448,	1456,	1464,	1472,	1480,	1488,	1496,
1504,	1512,	1520,	1528,	1536,	1544,	1552,	1560,
1568,	1576,	1584,	1592,	1600,	1608,	1616,	1624,
1632,	1640,	1648,	1656,	1664,	1672,	1680,	1688,
1696,	1704,	1712,	1720,	1728,	1736,	1744,	1752,
1760,	1768,	1776,	1784,	1792,	1800,	1808,	1816,
1824,	1832,	1840,	1848,	1856,	1864,	1872,	1880,
1888,	1896,	1904,	1912,	1920,	1928,	1936,	1944,
1952,	1960,	1968,	1976,	1984,	1992,	2000,	2008,
2016,	2024,	2032,	2040,	2048,	0,	0,	0,
0,	0,	0,	0,	0,	0,	0,	0,
0,	0,	0,	0,	1041,	0,	0,	24,
56,	0,	0,	0,	0,	0,	0,	0,
0,	0,	0,	0,	0,	0,	0,	0,
0,	0,	0,	0,	0,	0,	0,	0,
0,	0,	0,	0,	0,	64,	0,	0,
0,	0,	0,	0,	0,	0,	0,	0,
0,	0,	0,	0,	0,	0,	0,	0,
0,	0,	0,	0,	15360,	6,	0,	0,
0,	0,	0,	0,	0,	0,	0,	0,
0,	0,	0,	0,	0,	0,	0,	0,
12896,	50,	0,	0,	61696,	62976,	0,	0,
0,	0,	0,	24576,	0,	0,	0,	0,
0,	0,	0,	0,	0,	0,	0,	0,
0,	0,	0,	0,	0,	0,	0,	6144,
0,	0,	0,	0,	0,	0,	0,	0,
0,	0,	0,	0,	40965,	124,	31868,	31744,
31868,	31868,	0,	0,	10251,	0,	0,	24,
124,	0,	0,	0,	0,	0,	0,	0,
0,	0,	0,	0,	0,	0,	0,	0,
0,	0,	0,	0,	0,	0,	0,	0,
0,	0,	0,	0,	16,	96,	0,	0,
0,	0,	0,	0,	0,	0,	0,	0,
0,	0,	3584,	57368,	0,	0,	6150,	24576,
28,	24,	96,	24600,	26214,	12,	6206,	24576,
24600,	26112,	102,	14,	0,	1542,	1542,	12850,
0,	0,	24576,	96,	0,	12850,	1,	0,
31280,	26234,	4102,	0,	23296,	63078,	0,	0,
0,	0,	0,	24576,	0,	0,	0,	0,
0,	0,	0,	0,	0,	0,	0,	0,
0,	124,	7680,	14,	0,	0,	0,	6144,
0,	14392,	0,	0,	65024,	0,	12288,	31756,
61182,	1,	2048,	14456,	40965,	698,	14906,	47234,
47800,	47802,	30720,	0,	55309,	6144,	26214,	26174,
6252,	24582,	102,	0,	1536,	6204,	32316,	32268,
32284,	15420,	0,	0,	15360,	6200,	15484,	32376,
15998,	32358,	52230,	50784,	15462,	15484,	16120,	26238,
50790,	26214,	7806,	30816,	16,	112,	96,	6,
14,	6240,	49164,	56,	0,	0,	0,	0,
0,	0,	6144,	12312,	0,	26172,	15372,	12390,
54,	26172,	26160,	12348,	15462,	24,	15486,	12390,
12348,	26214,	6246,	26142,	3608,	3084,	3084,	31354,
0,	24,	8192,	32,	0,	31354,	61,	32256,
19480,	26188,	31756,	31866,	24444,	26214,	31846,	32286,
14462,	32286,	15470,	32316,	7276,	14078,	28286,	31806,
32470,	32312,	32382,	7278,	0,	6144,	254,	254,
0,	15376,	15928,	4126,	31806,	0,	1632,	6158,
0,	31852,	0,	12336,	65144,	6144,	14396,	14364,
50942,	15361,	3584,	16448,	40965,	1734,	1542,	49350,
50880,	50886,	16384,	0,	10246,	6144,	26214,	26238,
6252,	12300,	6246,	0,	1536,	6270,	32382,	32268,
32316,	32382,	0,	14,	32480,	15484,	32382,	32380,
32382,	32358,	52230,	50784,	32358,	32382,	32508,	26238,
50790,	26214,	7806,	30816,	56,	56,	96,	6,
30,	6240,	49164,	56,	0,	0,	0,	24,
0,	0,	6144,	12312,	0,	26238,	26136,	6246,
28,	26214,	26136,	6246,	6168,	126,	26360,	6246,
6246,	102,	6144,	26168,	7740,	6168,	6168,	19532,
0,	24,	8192,	6176,	0,	19532,	126,	65024,
0,	0,	4120,	50890,	21958,	26112,	31862,	32286,
14462,	32286,	15470,	32318,	7278,	14078,	28286,	32318,
32470,	32312,	32318,	13934,	0,	15360,	126,	254,
512,	32272,	8300,	4112,	65150,	6144,	3696,	6169,
536,	31812,	0,	18552,	24,	15360,	11300,	47668,
55038,	26115,	3864,	16496,	40965,	1734,	1542,	49350,
50880,	50886,	28672,	0,	53255,	6144,	65382,	27744,
6200,	14364,	6204,	0,	1536,	14438,	3174,	24604,
1648,	26214,	6168,	32284,	26224,	32486,	26214,	24686,
24672,	6246,	55302,	61024,	26214,	26214,	24780,	26136,
50790,	26214,	6156,	6240,	56,	28,	96,	6,
24,	96,	49152,	24,	0,	0,	0,	24,
0,	0,	6144,	12312,	0,	102,	0,	0,
0,	0,	0,	0,	15420,	126,	216,	0,
0,	15360,	15462,	26160,	6246,	0,	0,	0,
15420,	0,	8960,	6179,	0,	0,	358,	55296,
15420,	60,	4096,	33482,	20866,	26342,	3190,	3078,
6150,	26116,	3174,	1542,	3134,	14078,	26214,	1598,
26326,	1560,	26166,	12902,	26112,	26210,	610,	7776,
32256,	26236,	12486,	31868,	50912,	6270,	7224,	6171,
15896,	31852,	0,	6216,	48,	26112,	58916,	37479,
37628,	49923,	2364,	16448,	45069,	1734,	1542,	49350,
50880,	50886,	16508,	0,	4142,	6144,	65382,	3168,
6200,	6168,	6204,	0,	3072,	14438,	3174,	24604,
1632,	26214,	6168,	32312,	26168,	26306,	26214,	24678,
24672,	6246,	55302,	61024,	26230,	26214,	24780,	26136,
50790,	26172,	6156,	6192,	108,	15372,	15484,	15422,
15896,	14460,	52236,	27672,	15420,	15996,	15996,	26238,
50790,	26214,	6270,	12312,	6242,	26214,	15420,	15420,
15420,	15420,	14396,	14392,	32382,	30304,	15576,	15420,
26214,	32358,	32358,	26160,	6246,	14396,	26172,	26172,
32318,	24,	9728,	38,	0,	15420,	15718,	55422,
32382,	126,	4096,	47818,	186,	26214,	3134,	3078,
6246,	26124,	3174,	1542,	3126,	14022,	13926,	1542,
26326,	1560,	26166,	6262,	63248,	26358,	32352,	14384,
64614,	17094,	6342,	54998,	50880,	6270,	14364,	6171,
31744,	14392,	7936,	12360,	24,	49920,	33572,	54977,
47868,	37126,	2108,	14400,	45069,	642,	14906,	47290,
33464,	47802,	30846,	0,	57401,	6144,	26214,	6268,
6256,	6168,	32511,	32256,	3072,	6246,	6156,	31804,
3168,	32316,	6168,	112,	3100,	26330,	24702,	31846,
28284,	6270,	61446,	65120,	26230,	26214,	28876,	26136,
50790,	15420,	6168,	6192,	108,	15876,	31870,	32382,
32382,	14462,	56332,	65048,	32382,	32382,	32382,	26238,
50790,	26214,	14462,	14360,	6386,	26208,	15998,	15934,
31806,	32382,	14462,	14392,	26214,	32608,	32478,	32382,
26214,	26214,	26214,	32304,	6246,	14398,	26238,	26238,
26118,	24,	11264,	6188,	45082,	32318,	32366,	57087,
26214,	102,	4096,	41674,	170,	26214,	3132,	3086,
6246,	26124,	102,	1542,	3174,	14022,	15990,	1542,
26358,	1560,	30262,	15422,	39184,	26332,	64608,	27672,
36966,	17026,	15558,	37522,	50880,	32256,	28686,	6168,
16510,	0,	4096,	24648,	72,	33024,	33767,	50881,
14584,	37126,	2108,	0,	47133,	0,	31868,	31868,
124,	31868,	6,	0,	56,	6144,	26214,	6206,
6256,	6168,	32511,	32256,	6144,	6254,	6156,	32316,
3196,	15932,	6168,	224,	3086,	26326,	24700,	31846,
28284,	6270,	61446,	54880,	26238,	26214,	14588,	26136,
54886,	15384,	6168,	6168,	198,	1536,	24678,	26214,
26238,	6246,	63500,	65048,	26214,	26214,	24678,	26136,
54886,	26172,	61452,	7704,	15550,	26208,	1638,	1542,
24582,	26214,	6246,	6168,	26214,	7036,	26334,	26214,
26214,	26214,	24678,	15408,	32380,	6150,	26214,	30310,
26174,	24,	6144,	6168,	55350,	26118,	26222,	57051,
26214,	102,	4096,	41674,	178,	26214,	3132,	3102,
6246,	26124,	102,	3590,	3174,	14022,	6262,	1590,
26358,	1560,	30262,	26126,	39224,	31880,	43104,	50700,
12390,	32386,	26310,	37522,	50940,	32382,	14364,	6168,
638,	0,	53248,	30792,	48,	59136,	59009,	54887,
47866,	40332,	30780,	7198,	39993,	642,	15032,	14906,
698,	15034,	3590,	61447,	0,	6144,	65280,	12294,
222,	6168,	6204,	0,	6144,	6262,	3096,	1644,
6270,	1638,	0,	32368,	6172,	32470,	24678,	24678,
26208,	6246,	55302,	54880,	26238,	26238,	7416,	26136,
54886,	6168,	6192,	6168,	198,	15872,	24678,	26214,
26136,	6246,	61452,	54808,	26214,	26214,	28768,	26136,
54886,	26172,	61464,	7704,	9372,	26208,	15974,	15934,
24638,	26214,	6246,	6168,	32382,	31612,	26360,	26214,
26214,	26214,	24678,	6398,	6246,	6206,	26214,	32358,
26238,	48,	12288,	6194,	27756,	26174,	28278,	55515,
32382,	102,	0,	41594,	186,	26214,	3182,	3126,
6246,	26124,	102,	7174,	3174,	14022,	7174,	1590,
26310,	1560,	1590,	26118,	61240,	26248,	10336,	50700,
12390,	17026,	17004,	37522,	50940,	6270,	7224,	6168,
15872,	0,	53248,	0,	0,	9216,	11459,	37428,
37618,	33164,	63548,	4624,	40569,	1734,	1728,	1542,
1734,	1734,	4222,	63503,	0,	6144,	65280,	13830,
222,	6168,	6204,	0,	12288,	6246,	3096,	1644,
6246,	1638,	0,	32312,	6200,	32476,	24678,	24678,
26208,	6246,	55302,	50784,	26222,	26236,	3800,	26136,
65126,	6204,	6192,	6156,	0,	32256,	24678,	32358,
26136,	6246,	63500,	54808,	26214,	26214,	15456,	26136,
65126,	26136,	14360,	14360,	26112,	26208,	32382,	32382,
24702,	32382,	6270,	6168,	32382,	65376,	26360,	26214,
26214,	26214,	26214,	32304,	6246,	6270,	26214,	32358,
26214,	32304,	28286,	6246,	14040,	26238,	32374,	55519,
32382,	102,	0,	47626,	170,	26214,	3182,	3126,
6246,	26124,	102,	12294,	3182,	14022,	3710,	1590,
26310,	1560,	1590,	15366,	26220,	26332,	10336,	50712,
12390,	17026,	16936,	37522,	50880,	6144,	3696,	6168,
31768,	0,	20504,	0,	0,	9216,	14438,	47644,
55030,	50136,	28798,	7196,	36465,	1734,	1728,	1542,
1734,	1734,	3174,	60447,	0,	0,	26112,	26238,
204,	6168,	6246,	24,	12312,	6246,	26160,	1662,
12390,	1638,	6168,	28,	6256,	26304,	26214,	24678,
26208,	6246,	52326,	50784,	26222,	26208,	1740,	26136,
65084,	6204,	6240,	6156,	0,	26112,	24678,	24678,
26136,	6246,	55308,	54808,	26214,	26214,	3680,	26136,
65084,	26172,	6192,	12312,	16896,	26214,	26208,	26214,
24678,	24672,	6240,	6168,	26214,	55392,	26328,	26214,
26214,	26214,	32358,	6192,	6246,	6246,	26214,	28262,
26214,	32358,	54142,	6350,	27756,	26214,	30310,	55512,
26214,	102,	0,	33290,	130,	26214,	32358,	3126,
6246,	26124,	126,	12350,	31854,	32510,	32382,	1590,
59134,	1560,	1598,	6150,	108,	26358,	10336,	50736,
12390,	26310,	26282,	54998,	50880,	6270,	1632,	55320,
16408,	0,	28732,	0,	0,	9216,	12348,	14348,
50918,	26200,	255,	5136,	36465,	1734,	1728,	1542,
1734,	1734,	614,	1048,	0,	0,	26112,	26236,
204,	14364,	102,	24,	24600,	6246,	26160,	26238,
12390,	3686,	6168,	14,	224,	26338,	26214,	24686,
26208,	6246,	52326,	50784,	26214,	27232,	1740,	26136,
60988,	6246,	6240,	6150,	0,	26112,	24678,	24678,
32280,	6246,	52236,	50712,	26214,	26214,	1632,	26136,
60988,	32316,	6192,	12312,	49920,	26214,	26208,	26214,
24678,	24672,	6240,	6168,	26214,	55392,	26328,	26214,
26214,	26238,	15462,	6192,	6268,	6246,	26214,	26214,
32382,	24678,	1542,	6170,	55350,	26214,	26214,	55512,
26214,	102,	0,	50698,	198,	63078,	32354,	3126,
6246,	26116,	126,	12348,	31854,	32380,	32382,	1590,
59134,	1560,	1598,	19462,	198,	31842,	10336,	27744,
8319,	32380,	32494,	31868,	50912,	126,	0,	55320,
0,	0,	8252,	0,	0,	15360,	24,	31744,
61166,	15472,	16,	4624,	34401,	698,	15032,	14850,
698,	15034,	7294,	1048,	0,	6144,	0,	24,
254,	12300,	0,	24,	24600,	32382,	32382,	32268,
12414,	15486,	6168,	0,	6144,	26238,	32382,	32380,
32352,	32358,	50814,	50814,	32358,	31840,	32454,	32280,
50712,	6246,	7806,	30726,	65024,	32256,	32382,	32382,
15896,	15462,	52748,	50748,	32358,	32382,	32352,	32286,
50712,	15974,	6270,	12312,	65280,	32382,	32382,	32382,
32382,	32382,	15486,	15420,	26214,	65406,	32478,	32382,
32382,	32318,	6270,	6271,	6252,	15486,	32382,	26214,
15422,	24702,	3078,	6194,	45082,	32382,	32382,	65279,
26214,	126,	0,	31754,	124,	63222,	0,	0,
0,	0,	0,	0,	0,	0,	0,	48,
0,	1560,	1536,	27654,	198,	27648,	96,	14590,
93,	15376,	15468,	4112,	50814,	32256,	32382,	38936,
0,	0,	24,	0,	0,	0,	0,	0,
0,	48,	56,	0,	33345,	124,	31868,	31744,
124,	31868,	60,	1040,	0,	6144,	0,	24,
118,	24582,	0,	24,	24600,	32316,	15486,	15372,
12348,	14396,	6168,	0,	6144,	26172,	15484,	32376,
15456,	32358,	50748,	50814,	15462,	13920,	31942,	15384,
33304,	6246,	7806,	30726,	65024,	15872,	15996,	15934,
1560,	15462,	50700,	50748,	15462,	15996,	31840,	15886,
33304,	1638,	6270,	12312,	0,	15932,	15934,	15934,
15934,	15934,	15422,	15420,	26214,	32638,	15582,	15420,
15934,	15366,	6204,	6399,	28768,	15422,	15932,	26214,
0,	24636,	6150,	6207,	0,	15422,	48316,	32383,
26214,	60,	0,	10,	0,	3598,	0,	0,
0,	0,	0,	0,	0,	0,	0,	48,
0,	1560,	1536,	14342,	0,	24576,	240,	254,
192,	16,	0,	4336,	50750,	32256,	32382,	28696,
0,	0,	0,	0,	0,	0,	0,	0,
0,	32,	16,	0,	0,	0,	0,	0,
0,	0,	0,	15390,	0,	0,	0,	0,
0,	0,	0,	48,	0,	0,	0,	0,
0,	0,	12288,	0,	0,	0,	0,	0,
0,	0,	0,	0,	0,	0,	0,	0,
0,	0,	0,	0,	0,	0,	0,	0,
32256,	0,	124,	0,	0,	1632,	0,	0,
0,	32256,	3584,	57368,	0,	12,	0,	0,
3072,	0,	0,	0,	0,	0,	0,	0,
0,	126,	0,	0,	24640,	0,	0,	0,
32382,	0,	7936,	6146,	0,	0,	32896,	0,
0,	0,	0,	0,	0,	31804,	0,	0,
0,	0,	0,	0,	0,	0,	0,	48,
0,	0,	0,	0,	0,	16384,	0,	0,
128,	124,	0,	224,	0,	0,	0,	24,
0,	0,	0,	0,	0,	0,	0,	0,
0,	0,	0,	0,	0,	0,	0,	0,
0,	0,	0,	21527,	0,	0,	0,	0,
0,	0,	0,	32,	0,	0,	0,	0,
0,	0,	8192,	0,	0,	0,	0,	0,
0,	0,	0,	0,	0,	0,	0,	0,
0,	0,	0,	0,	0,	0,	0,	0,
31744,	0,	120,	0,	0,	1632,	0,	0,
0,	31744,	0,	0,	0,	56,	0,	0,
14336,	0,	0,	0,	0,	0,	0,	0,
0,	124,	0,	0,	0,	0,	0,	0,
0,	0,	0,	0,	0,	0,	0,	0,
0,	0,	0,	0,	0,	30776,	0,	0,
0,	0,	0,	0,	0,	0,	0,	0,
0,	0,	0,	0,	0,	0,	0,	0,
0,	0,	0,	0,	0,	0,	0,	24,
0,	0,	0,	0,	0,	
};
unsigned	short	_font2[]	=	{
1,	8,	30774,	8246,	31091,	29811,	28005,	26144,
28271,	116,	0,	0,	0,	0,	0,	0,
0,	0,	0,	255,	4,	4,	3,	1,
1,	6,	6,	0,	3,	1,	1,	21845,
43690,	8,	88,	0,	88,	0,	602,	0,
192,	6,	0,	0,	0,	6,	12,	18,
24,	30,	36,	42,	48,	54,	60,	66,
72,	78,	84,	90,	96,	102,	108,	114,
120,	126,	132,	138,	144,	150,	156,	162,
168,	174,	180,	186,	192,	198,	204,	210,
216,	222,	228,	234,	240,	246,	252,	258,
264,	270,	276,	282,	288,	294,	300,	306,
312,	318,	324,	330,	336,	342,	348,	354,
360,	366,	372,	378,	384,	390,	396,	402,
408,	414,	420,	426,	432,	438,	444,	450,
456,	462,	468,	474,	480,	486,	492,	498,
504,	510,	516,	522,	528,	534,	540,	546,
552,	558,	564,	570,	576,	582,	588,	594,
600,	606,	612,	618,	624,	630,	636,	642,
648,	654,	660,	666,	672,	678,	684,	690,
696,	702,	708,	714,	720,	726,	732,	738,
744,	750,	756,	762,	768,	774,	780,	786,
792,	798,	804,	810,	816,	822,	828,	834,
840,	846,	852,	858,	864,	870,	876,	882,
888,	894,	900,	906,	912,	918,	924,	930,
936,	942,	948,	954,	960,	966,	972,	978,
984,	990,	996,	1002,	1008,	1014,	1020,	1026,
1032,	1038,	1044,	1050,	1056,	1062,	1068,	1074,
1080,	1086,	1092,	1098,	1104,	1110,	1116,	1122,
1128,	1134,	1140,	1146,	1152,	1158,	1164,	1170,
1176,	1182,	1188,	1194,	1200,	1206,	1212,	1218,
1224,	1230,	1236,	1242,	1248,	1254,	1260,	1266,
1272,	1278,	1284,	1290,	1296,	1302,	1308,	1314,
1320,	1326,	1332,	1338,	1344,	1350,	1356,	1362,
1368,	1374,	1380,	1386,	1392,	1398,	1404,	1410,
1416,	1422,	1428,	1434,	1440,	1446,	1452,	1458,
1464,	1470,	1476,	1482,	1488,	1494,	1500,	1506,
1512,	1518,	1524,	1530,	1536,	33280,	8452,	46799,
58125,	58116,	20609,	34809,	50108,	16076,	57459,	7992,
17028,	52480,	31636,	3110,	33841,	136,	1536,	20336,
13116,	16071,	50033,	6156,	7174,	53105,	62238,	40687,
49289,	17042,	39976,	53233,	64030,	41512,	12170,	49566,
226,	2144,	2048,	32769,	384,	24608,	0,	0,
8192,	0,	0,	12558,	196,	16761,	20744,	2,
17441,	8468,	2053,	1824,	20872,	4098,	17745,	6660,
1583,	16656,	61700,	7399,	96,	49200,	27843,	41833,
322,	6884,	16745,	26888,	48615,	43339,	31676,	7423,
64635,	62238,	36365,	49145,	63926,	24269,	57403,	55358,
192,	52993,	63680,	224,	51057,	6156,	35971,	34424,
3078,	6850,	49200,	28928,	16071,	49665,	25094,	10927,
5914,	33414,	20481,	32968,	49796,	524,	26451,	16160,
62530,	52480,	41918,	3149,	50016,	8,	3072,	49304,
21122,	520,	9098,	12556,	9955,	10378,	35488,	8200,
32904,	17300,	41580,	10378,	8864,	41512,	8530,	24600,
103,	53089,	31004,	7874,	33201,	8484,	7247,	59377,
29198,	41512,	10058,	12428,	35022,	640,	20,	7808,
592,	20480,	128,	51963,	20,	2181,	0,	8974,
34925,	33312,	8,	41472,	0,	49200,	62982,	50354,
29324,	11458,	688,	60188,	55096,	11521,	2188,	35937,
48433,	7046,	50919,	47577,	6326,	22125,	28440,	55526,
5794,	26219,	25086,	48838,	28019,	8602,	4804,	57603,
4248,	11456,	57417,	26631,	99,	25091,	57147,	7278,
38834,	56964,	20705,	36808,	50110,	36591,	8307,	24759,
37986,	51456,	28692,	6278,	51040,	446,	6368,	18344,
37660,	1231,	57457,	24576,	35841,	61371,	35616,	9935,
33016,	17048,	41642,	12274,	8732,	43560,	16929,	12312,
32877,	10288,	35744,	41703,	33224,	9016,	41704,	9354,
8856,	43560,	8498,	12312,	40043,	10114,	28956,	8391,
51057,	8472,	7303,	61312,	29084,	41672,	51337,	29080,
7887,	34673,	61730,	41519,	59233,	52406,	39885,	50545,
47766,	7399,	112,	59912,	21979,	10057,	6156,	35949,
48409,	6278,	18022,	48601,	55452,	22127,	26136,	29174,
11719,	50899,	13140,	35942,	60843,	29340,	37543,	34424,
12294,	32975,	49968,	26628,	193,	36096,	25222,	43692,
57314,	37852,	22691,	52441,	55302,	35945,	61403,	16548,
26657,	49152,	10558,	32878,	50016,	12296,	12291,	18632,
63490,	34856,	9096,	12556,	3299,	10418,	35488,	8712,
34952,	17044,	41513,	10882,	8706,	13861,	33872,	6168,
96,	59395,	35488,	7682,	33160,	8740,	41640,	9354,
8710,	10789,	57905,	12300,	12993,	12162,	2178,	40992,
61435,	8328,	41608,	35571,	35362,	41512,	10362,	8334,
34957,	34824,	35234,	40103,	97,	5259,	63174,	9738,
41626,	41672,	136,	27144,	49400,	44363,	14476,	35949,
48409,	6272,	18022,	45529,	53390,	22124,	26136,	12742,
44493,	26323,	25364,	35942,	26027,	43574,	4772,	0,
12288,	6848,	768,	26932,	231,	34560,	8452,	46793,
4162,	6204,	23783,	52441,	63494,	35949,	26584,	28988,
61678,	0,	61972,	109,	33841,	12424,	8195,	20336,
5052,	2247,	50033,	6148,	6,	12162,	62238,	7912,
51081,	31250,	39976,	51585,	8636,	8930,	36744,	2462,
224,	61185,	31004,	706,	49545,	29218,	39976,	58609,
4380,	14050,	10056,	12686,	16064,	10362,	64318,	40687,
2178,	8200,	48783,	60289,	35490,	41512,	10250,	31108,
2255,	35064,	35234,	96,	201,	15494,	27843,	9466,
31116,	48879,	136,	11016,	16410,	11336,	26814,	35949,
48921,	61824,	57062,	65395,	49342,	63087,	26392,	12998,
39560,	50795,	49428,	52423,	52593,	29110,	37571,	59259,
12446,	11394,	0,	28,	0,	33280,	0,	0,
58113,	4120,	19638,	53241,	7102,	36079,	24824,	22535,
172,	49152,	8192,	32774,	0,	24576,	0,	0,
0,	0,	0,	8,	3072,	120,	0,	0,
0,	0,	0,	24576,	0,	0,	0,	0,
15872,	0,	0,	15360,	3584,	0,	0,	8320,
0,	0,	49155,	12288,	0,	59329,	31006,	47335,
51057,	28956,	41672,	248,	28956,	40647,	51185,	128,
12428,	51065,	35102,	48687,	112,	1039,	192,	52089,
16,	41480,	112,	10496,	32999,	49168,	0,	0,
0,	0,	0,	0,	49152,	0,	0,	256,
128,	1539,	63488,	2060,	112,	49180,	128,	0,
13056,	0,	0,	8,	0,	
};

GFONT	*_font, *_sysfonts[8];
short _textcol, _texteff, _no_of_fonts, _fontno;
extern	short	_fillcol, _clipx1, _clipx2, _clipy1, _clipy2;
extern	FDB	_screen;

int vst_color(int handle, int color) {
/*Sets the color of text.*/
	return(_textcol=(color&255));
}

int vst_effects(int handle, int effects) {
/*Sets the text effects used by v_gtext.*/
	return(_texteff=(effects&255));
}

int vst_font(int handle, int font) {
/*There are 3 fonts in MAD as standard, and more may be loaded up to a 
total of 8. This routine sets the font used to one of them.*/
	if(font>=_no_of_fonts) font=0;
	_font=_sysfonts[font];
	return(_fontno=font);
}

void _undumb(unsigned short *dumb) {
unsigned char temp=((unsigned char *)dumb)[1];
	*dumb=((*dumb)<<8)|temp;
}

void _fontfix(short fontno) {
GFONT *font=_sysfonts[fontno];
short i, *j;
	font->coff_base=(short *)font+sizeof(GFONT)/2;
	if(font->flags&1024) {
		_undumb(&font->font_id); _undumb(&font->size);
		j=&font->first_ade; i=0; while(i<16) {
			_undumb(j); i++; j++;
		}
		_undumb(&font->form_width); _undumb(&font->form_height);
		j=font->coff_base; i=0; while(i<font->last_ade-font->first_ade+2) {
			_undumb(j); i++; j++;
		}
	}
	font->form_base=(short *)(font->coff_base+font->last_ade
		-font->first_ade+2);
}

int vst_user_font(int handle, GFONT *font) {/*needed*/
/*For convenience, this routine can take the address of a font file that 
has been compiled into an application, assign it as a usable font and 
return the font number. Again, -1 indicates a failure.*/
	if(_no_of_fonts>7) return(-1);
	_sysfonts[_no_of_fonts]=font;
	if(_no_of_fonts) (_sysfonts[_no_of_fonts-1])->next_font=(char *)font;
	_fontfix(_no_of_fonts);
	return(_no_of_fonts++);
}

int vst_load_font(int handle, const char *fontname) {/*needed*/
/*Loads from disk a font by name for the next available slot, and returns 
the font number, or -1 if it fails.*/
short size;
FILE *fp;
GFONT *font;
	if(_no_of_fonts>7||!(fp=fopen(fontname, "rb"))) return(-1);
	fseek(fp, 0, SEEK_END);
	size = ftell(fp);
	fseek(fp, 0, SEEK_SET);
	if((font=(GFONT *)malloc(size))==NULL) {
		fclose(fp); return(-1);
	}
	fread(font, size, 1, fp);
	fclose(fp);
	return(vst_user_font(handle, font));
}

int vst_unload_font(int handle, int delfont) {
/*Clears a font slot (not the 3 defaults) and moves fonts up to fill the 
gap. Returns the new number of fonts or -1.*/
int i;
	if(delfont<3||delfont>=_no_of_fonts) return(0);
	free(_sysfonts[delfont]); _no_of_fonts--;
	i=delfont; while(i<_no_of_fonts) {
		_sysfonts[i]=_sysfonts[i+1]; i++;
	}
	if(_fontno>=delfont) {
		if(_fontno==3) _fontno=0;
		else _fontno--;
		vst_font(handle, _fontno);
	}
	return(_no_of_fonts);
}

void v_gtext(int handle, int ox, int oy, const char *text) {
/*This routine prints a string in the default font.
A few effects are available and may be combined.
NORMAL 0 No effects
THICKENED 1 The text is 1 pixel thicker, giving a bolder look
SHADED 2 Only odd pixels are printed, giving a feint look
SLANTED 4 The top of the text is displaced to the right
UNDERLINED 8 The text is underlined, apart from spaces
DOUBLED 16 The text is twice as thick, at the original height*/
char *whole, *mover, *lose=(char *)text, *m;
int i, j, k, l, n=0, z=ox, length, start, letter, bits, thisdot, lastdot,
	thick=(_texteff&THICKENED), shade=(_texteff&SHADED),
	uline=(_texteff&UNDERLINED), slant=(_texteff&SLANTED),
	twice=(_texteff&DOUBLED);
short px[8];
FDB gtextfdb;
	gtextfdb.fd_h=_font->form_height;
	gtextfdb.fd_w=_clipx2-ox;
	gtextfdb.fd_addr=alloca(gtextfdb.fd_h*gtextfdb.fd_w);
	memset(gtextfdb.fd_addr, _fillcol, gtextfdb.fd_h*gtextfdb.fd_w);
	oy-=_font->top; if(oy<0) { n=-oy; oy=0; }
	px[0]=px[1]=0; px[3]=gtextfdb.fd_h-1-n;
	px[4]=ox; px[5]=oy; px[7]=oy+px[3];
	while(*lose&&z<_clipx2) {
		letter=*lose-_font->first_ade;
		if(letter>_font->last_ade||letter<0) break;
		start=_font->coff_base[letter];
		length=_font->coff_base[letter+1]-start;
		bits=7-(start&7);
		whole=(char *)_font->form_base+(start>>3)+n*_font->form_width;
		m=gtextfdb.fd_addr+(z-ox);
		i=n; while(i<_font->form_height-(uline==UNDERLINED)) {
			mover=whole; k=bits;
			l=0; if(slant) l=(_font->form_height-i)>>1;
			thisdot=j=0; while(j<length&&z+l<_clipx2) {
				lastdot=thisdot;
				thisdot=(*mover&(1<<k))?1:0;
				if((thick&&lastdot)||(thisdot&&(!(((j+i)&1)&&shade))))
					m[l]=_textcol;
				if(twice&&z+l<_clipx2) {
					l++; if(thisdot) m[l]=_textcol;
				}
				if((--k)<0) { k=7; mover++; }
				j++; l++;
			}
			i++; m+=gtextfdb.fd_w; whole+=_font->form_width;
		}
		if(uline&&letter!=' ') memset(m, _textcol, l);
		z+=l;
		lose++;
	}
   if(slant) z+=((_font->form_height>>(twice!=DOUBLED))+(thick==THICKENED));
	px[2]=z-1-ox; px[6]=z-1;
	vro_cpyfm(handle, S_ONLY, px, &gtextfdb, &_screen);
}
